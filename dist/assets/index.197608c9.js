var e,a,r=Object.defineProperty,l=Object.defineProperties,o=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,u=(e,a,l)=>a in e?r(e,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[a]=l,n=(e,a)=>{for(var r in a||(a={}))s.call(a,r)&&u(e,r,a[r]);if(t)for(var r of t(a))i.call(a,r)&&u(e,r,a[r]);return e},d=(e,a)=>l(e,o(a));"undefined"!=typeof require&&require;import{s as c}from"./good.9f30feb0.js";import{m as v,u as p,r as m,e as b,v as f,f as g,X as y,x as h,I as j,n as O,Y as A,Z as w,i as I,J as k,_ as x,A as D}from"./vendor.6c8c2553.js";/* empty css              *//* empty css              *//* empty css              */import"./request.324758d0.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import{h as E}from"./index.b2344599.js";import"./index.57763f1b.js";function N(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!I(e)}(a=e||(e={})).READY="ready",a.LOADING="loading",a.DONE="done",a.NODATA="noData",a.FAIL="fail",a.REFRESH="refresh";const R=[{label:"推荐",value:""},{label:"新品",value:"new"},{label:"价格",value:"price"}];var P={name:"ProductList",setup(){const a=v(),r=p(),l=m(e.READY),o=m({pageNumber:1,keyword:"",orderBy:"",goodsCategoryId:void 0}),t=m(!1),s=m([]),i=m(!1),u=m(!1),I=m(!1),P=b((()=>{var e;return(null==(e=o.value.keyword)?void 0:e.trim())||""})),C=async()=>{var a;if(P.value||o.value.goodsCategoryId){L(),t.value?l.value=e.REFRESH:l.value=e.LOADING;try{const r=await c(d(n({},o.value),{keyword:P.value}));s.value=(null==(a=r.data)?void 0:a.list)||[],l.value=s.value.length?e.DONE:e.NODATA}catch(r){l.value=e.FAIL,console.error("搜索商品失败",r)}finally{t.value=!1}}else l.value=e.READY},L=()=>{o.value.pageNumber=1,I.value=!1,u.value=!1},S=e=>{o.value.orderBy=e,C()},F=async()=>{var e;if("number"==typeof o.value.pageNumber){o.value.pageNumber++,i.value=!0;try{const a=await c(d(n({},o.value),{keyword:P.value})),r=a.data||{},l=(null==(e=a.data)?void 0:e.list)||[];s.value.push(...l),I.value=r.currPage<=r.totalPage}catch(a){u.value=!0,console.error("获取商品失败",a)}finally{i.value=!1}}else u.value=!0},Y=()=>{C()},q=()=>{a.back()};return f((()=>{o.value.goodsCategoryId=String(r.query.categoryId||""),C()})),()=>{let r,n;const d=g(k,{image:"search",description:"搜索想要的商品"},null),c=g(k,{image:"search",description:"抱歉，没有找到商品"},null),v=g(k,{image:"search",description:"正在搜索"},null),p=g(k,{image:"search",description:"搜索失败"},null),m=g(y,{modelValue:t.value,"onUpdate:modelValue":e=>t.value=e,onRefresh:Y},{default:()=>[g(x,{class:"search-list",loading:i.value,error:u.value,"error-text":"请求失败，点击重新加载",finished:I.value,"finished-text":"没有更多了","onUpdate:error":e=>u.value=e,"onUpdate:loading":e=>i.value=e,onLoad:F},N(r=s.value.map((e=>g(D,{price:e.sellingPrice,desc:e.goodsIntro,title:e.goodsName,thumb:E(e.goodsCoverImg),onClick:()=>(e=>{a.push({path:`/product/${e.goodsId}`})})(e)},null))))?r:{default:()=>[r]})]});let b="";switch(l.value){case e.READY:b=d;break;case e.NODATA:b=c;break;case e.LOADING:b=v;break;case e.FAIL:b=p;break;case e.DONE:case e.REFRESH:b=m}return g("div",{class:"product-list"},[g("div",{class:"product-list-top"},[g("div",{class:"product-list-top-fixed"},[g(h,{modelValue:o.value.keyword,"onUpdate:modelValue":e=>o.value.keyword=e,"show-action":!0,placeholder:"请输入搜索关键词",onSearch:C},{left:()=>g("span",{class:"back-icon",onClick:q},[g(j,{name:"arrow-left"},null)]),action:()=>g("div",{onClick:C},[O("搜索")])}),g(A,{type:"card",onChange:S},N(n=R.map((e=>g(w,{name:e.value,title:e.label},null))))?n:{default:()=>[n]})])]),b])}}};P.__scopeId="data-v-64458a7a";export{P as default};
