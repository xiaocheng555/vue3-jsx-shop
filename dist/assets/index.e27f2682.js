var e=Object.defineProperty,a=Object.defineProperties,r=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,t=(a,r,s)=>r in a?e(a,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[r]=s,l=(e,a)=>{for(var r in a||(a={}))o.call(a,r)&&t(e,r,a[r]);if(s)for(var r of s(a))d.call(a,r)&&t(e,r,a[r]);return e},i=(e,s)=>a(e,r(s));"undefined"!=typeof require&&require;import{A as n,g as c,a as u}from"./index.dfe7de59.js";import{b as p}from"./cart.7e38b868.js";import{N as m}from"./index.c77fe791.js";import{h as v}from"./index.b2344599.js";import{u as f,m as y,r as b,e as j,v as g,f as I,I as h,A as w,n as x,E as O,$ as C,F as P,s as k}from"./vendor.6c8c2553.js";import"./request.324758d0.js";/* empty css              *//* empty css              *//* empty css              */import{c as q,p as N}from"./order.035fef5e.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./index.57763f1b.js";var A={name:"OrderCreate",setup(){const e=f(),a=y(),r=b([]),s=b({}),o=b(0),d=b(!1),t=b(!1),A=b(!1),S=j((()=>String(e.query.cartItemIds||""))),E=j((()=>String(e.query.addressId||"")));let T;const _=()=>{let e=0;r.value.forEach((a=>{e+=(a.sellingPrice||0)*(a.goodsCount||0)})),o.value=e},D=()=>{a.push({query:i(l({},e.query),{page:"address"})}).then((()=>{t.value=!0}))},F=()=>{t.value=!1},U=r=>{s.value={addressId:r.id,userPhone:r.tel,address:r.address},t.value=!1,a.back(),setTimeout((()=>{a.replace({query:i(l({},e.query),{addressId:r.id})})}),100)},$=async()=>{try{d.value=!0;const e=await q({addressId:s.value.addressId,cartItemIds:S.value.split(",")});T=e.data,A.value=!0}catch(e){e.message&&e.resultCode&&k.fail(e.message),console.error("创建订单失败",e)}finally{d.value=!1}},z=async()=>{k.loading("支付中...");try{await N({orderNo:T,payType:1}),k.success("支付成功"),B()}catch(e){k.fail("支付失败"),B()}},B=()=>{a.replace("/order/index")},G=()=>{(async()=>{try{let e;e=E.value?await c(E.value):await u();const{regionName:a,provinceName:r,cityName:o,detailAddress:d,addressId:t,userPhone:l}=e.data||{};s.value={addressId:t,userPhone:l,address:[r,o,a,d].join(" ")}}catch(e){console.error("获取默认地址失败",e)}})(),(async()=>{try{const e=await p({cartItemIds:S.value});r.value=e.data||[],_()}catch(e){console.error("获取购物车商品失败",e)}})()};return g((()=>{G()})),()=>I(P,null,[t.value?I(n,{back:F,switchable:!0,defaultSelectAddressId:Number(E.value||s.value.addressId),onSelect:U},null):I("div",null,[I(m,{title:"生成订单",leftArrow:!0},null),I("div",{class:"order-address",onClick:D},[I("div",{class:"order-address-main"},[I("p",null,[s.value.userPhone]),I("p",null,[s.value.address])]),I("div",{class:"order-address-right"},[I(h,{name:"arrow"},null)])]),r.value.map((e=>I(w,{num:e.goodsCount,price:e.sellingPrice,title:e.goodsName,thumb:v(e.goodsCoverImg)},null))),I("div",{class:"order-footer-wrap"},[I("div",{class:"order-footer"},[I("div",{class:"order-footer-content"},[I("span",null,[x("商品金额")]),I("span",{class:"order-price"},[x("¥"),o.value])]),I(O,{type:"primary",round:!0,block:!0,loading:d.value,onClick:$},{default:()=>[x("生成订单")]})])]),I(C,{class:"order-pay-popup",closeOnClickOverlay:!1,closeable:!0,show:A.value,position:"bottom","onUpdate:show":()=>A.value=!A.value,teleport:"body",onClose:B},{default:()=>[I(O,{type:"primary",block:!0,onClick:z},{default:()=>[x("支付宝支付")]}),I(O,{type:"success",block:!0,onClick:z},{default:()=>[x("微信支付")]})]})])])}};A.__scopeId="data-v-4bf192e7";export{A as default};
