var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o;"undefined"!=typeof require&&require;import{g as l,m as c,d as i}from"./cart.7e38b868.js";import{N as d}from"./index.c77fe791.js";import{h as u}from"./index.b2344599.js";import{b as m,m as p,r as g,e as b,v as f,f as v,z as C,C as h,A as y,n as j,D as I,E as x,H as _,J as k,s as O}from"./vendor.6c8c2553.js";import"./request.324758d0.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./index.57763f1b.js";var w={name:"Cart",setup(){const e=m(),w=p(),P=g(0),V=g([]),q=b({get:()=>!!V.value.length&&V.value.every((e=>e._isCheck)),set(e){V.value.forEach((t=>{t._isCheck=!!e}))}}),E=async()=>{const c=O.loading("加载中...");try{const i=await l();V.value=(i.data||[]).map((e=>{return l=((e,t)=>{for(var a in t||(t={}))r.call(t,a)&&n(e,a,t[a]);if(o)for(var a of o(t))s.call(t,a)&&n(e,a,t[a]);return e})({},e),c={_isCheck:!0,_originCount:e.goodsCount},t(l,a(c));var l,c})),e.commit("setCartCount",V.value.length),U()}catch(i){console.error("获取购物车数据失败",i)}finally{c.clear()}},U=()=>{let e=0;V.value.forEach((t=>{t._isCheck&&(e+=(t.sellingPrice||0)*(t.goodsCount||0))})),P.value=e},D=()=>{U()},N=()=>{const e=V.value.map((e=>e.cartItemId)).join(",");w.push({path:"/order/create",query:{cartItemIds:e}})},S=()=>{w.push("/home")};return f((()=>{E()})),()=>v("div",{class:"cart-page"},[v(d,{title:"购物车"},null),V.value.map(((e,t)=>v(C,{key:e.cartItemId},{default:()=>v("div",{class:"cart-item"},[v(h,{class:"cart-item-checkbox",modelValue:e._isCheck,"onUpdate:modelValue":t=>e._isCheck=t,onChange:D},null),v(y,{class:"cart-item-card",title:e.goodsName,thumb:"string"==typeof e.goodsCoverImg?u(e.goodsCoverImg):""},{price:()=>v("span",{class:"cart-item-price"},[j("¥"),e.sellingPrice]),num:()=>v(I,{modelValue:e.goodsCount,"onUpdate:modelValue":t=>e.goodsCount=t,onChange:()=>(async e=>{const t=O.loading("加载中...");try{await c({cartItemId:e.cartItemId,goodsCount:e.goodsCount}),e._originCount=e.goodsCount,U()}catch(a){e.goodsCount=e._originCount,console.error("修改购物车商品失败",a)}finally{t.clear()}})(e)},null)})]),right:()=>v(x,{class:"delete-button",square:!0,text:"删除",type:"danger",onClick:()=>(async(e,t)=>{const a=O.loading("加载中...");try{await i(e.cartItemId),"number"==typeof t&&V.value.splice(t,1),U()}catch(o){console.error("删除购物车商品失败",o)}finally{a.clear()}})(e,t)},null)}))),V.value.length?v("div",{class:"submit-bar-wrap"},[v(_,{price:100*P.value,"button-text":"提交订单",onSubmit:N},{default:()=>[v(h,{modelValue:q.value,"onUpdate:modelValue":e=>q.value=e},{default:()=>[j("全选")]})]})]):v(k,{description:"购物车空空如也"},{default:()=>[v(x,{round:!0,type:"danger",class:"bottom-button",onClick:S},{default:()=>[j("前往选购")]})]})])}};w.__scopeId="data-v-1e68ce19";export{w as default};
